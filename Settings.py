# ==============================================================================
# Файл: Settings.py
# Проект: Бортовий Комп'ютер для Audi 80 B3 Monomotronic
# Опис: Глобальний файл конфігурації.
# Дата оновлення: 2025-12-15
# ==============================================================================

from micropython import const

# ------------------------------------------------------------------------------
# 1. ПІНИ ПІДКЛЮЧЕННЯ (HARDWARE PINS)
# ------------------------------------------------------------------------------
PIN_INJ = const(0) # Пін для входу сигналу форсунки (GPIO 0)
PIN_VSS = const(1) # Пін для входу сигналу датчика швидкості (VSS) (GPIO 1)
PIN_I2C_SDA = const(4) # Пін SDA для I2C (GPIO 4)
PIN_I2C_SCL = const(5) # Пін SCL для I2C (GPIO 5)
PIN_BUTTON_RESET = const(2) # Пін для кнопки скидання TRIP (GPIO 2)
PIN_SENSOR_BRAKE_FLUID = const(24) # Пін для датчика рівня гальмівної рідини (GPIO 24)
PIN_SENSOR_OIL_PRESSURE_LOW = const(7) # Пін для датчика низького тиску мастила (GPIO 7)
PIN_SENSOR_OVERHEAT_COOLANT_LEVEL = const(8) # Об'єднаний пін для датчиків перегріву двигуна та низького рівня охолоджувальної рідини (GPIO 8)
PIN_SENSOR_OIL_PRESSURE_HIGH = const(10) # Пін для датчика високого тиску мастила (GPIO 10)
PIN_SPEAKER = const(13) # Пін для динаміка/зумера (GPIO 12)
PIN_FUEL_LEVEL_ADC = const(28) # Пін для датчика рівня палива (ADC)

# ------------------------------------------------------------------------------
# 2. КАЛІБРУВАННЯ ШВИДКОСТІ ТА ВИТРАТИ ПАЛИВА
# ------------------------------------------------------------------------------
INJ_FLOW_RATE_ML_PER_MIN = const(813) # Продуктивність форсунки в мл/хв (Bosch 0 280 150 651 - 813 мл/хв при 1.3 бар)
VSS_IMPULSES_PER_KM = const(4000) # Кількість імпульсів датчика швидкості (VSS) на 1 кілометр

# Ліміти для автоматичного скидання TRIP (тимчасової поїздки)
MAX_TRIP_LITERS = const(99.9) # Максимальна кількість палива TRIP (99.9 L), після якої скидається
MAX_TRIP_DISTANCE = const(999) # Максимальна відстань TRIP (999 KM), після якої скидається

# ------------------------------------------------------------------------------
# 3. НАЛАШТУВАННЯ ДАТЧИКА ПАЛИВА (ADC)
# ------------------------------------------------------------------------------
# Діапазон сирих значень ADC (0-65535 для 16-біт ADC) Обем бака 68 літрів
FUEL_ADC_MIN_RAW = const(1000) # Мінімальне сире значення ADC для 0% палива
FUEL_ADC_MAX_RAW = const(60000) # Максимальне сире значення ADC для 100% палива

# Параметри згладжування та обмеження швидкості зміни рівня палива
FUEL_BUFFER_SIZE = const(10) # Кількість останніх значень ADC для обчислення середнього (згладжування)
FUEL_MAX_PERCENT_CHANGE_PER_SEC = const(10) # Максимальна дозволена зміна % палива за секунду (для захисту від стрибків)

# Параметри гістерезису для активації/деактивації попередження "Мало палива"
FUEL_LOW_THRESHOLD_PERCENT = const(6) # Відсоток палива, при якому активується попередження "Мало палива" (4 літра)
FUEL_HIGH_THRESHOLD_PERCENT = const(12) # Відсоток палива, при якому деактивується попередження "Мало палива" (8 літра)

# Тривалість відображення помилки "Мало палива" та головного екрану
LOW_FUEL_DISPLAY_DURATION_MS = const(3000) # Тривалість відображення іконки "Мало палива" (3 секунди)
LOW_FUEL_MAIN_SCREEN_DURATION_MS = const(15000) # Тривалість відображення головного екрану після "Мало палива" (15 секунд)

# ------------------------------------------------------------------------------
# 5. НАЛАШТУВАННЯ ДИСПЛЕЯ ТА ТЕКСТУ
# ------------------------------------------------------------------------------
# Основний показник (миттєва витрата L/H або L/100KM)
MAIN_VALUE_FONT_SIZE = const(3) # Розмір шрифту основного показника (кожен символ 8*4=32px)
MAIN_VALUE_Y_POS = const(8) # Позиція Y основного показника
MAIN_VALUE_X_OFFSET = const(-7) # Зміщення X основного показника від центру (позитивне вправо, негативне вліво)

# Одиниці виміру (L/100KM, L/H) для основного показника
MAIN_UNIT_FONT_SIZE_X = const(1) # Розтягування шрифту X для одиниць виміру (кожен символ 8*2=16px)
MAIN_UNIT_FONT_SIZE_Y = const(2) # Розтягування шрифту Y для одиниць виміру
MAIN_UNIT_Y_OFFSET = const(18) # Зміщення Y одиниць виміру від основного показника

# Налаштування рамки основного показника (охоплює основне значення та одиниці)
MAIN_FRAME_PADDING_PX = const(4) # Відступ рамки від найближчих елементів
MAIN_FRAME_RADIUS_PX = const(2) # Радіус заокруглення кутів рамки основного показника

# Статистика поїздок (TRIP та PERS)
TRIP_STAT_Y_POS_FUEL_LESS = const(74) # Позиція Y для рядка TRIP
PERS_STAT_Y_POS_FUEL_LESS = const(96) # Позиція Y для рядка PERS
STAT_TEXT_X_POS = const(9) # Початкова X-координата для тексту статистики (за замовчуванням 0 - лівий край)

# Ширина числових полів для форматування TRIP та PERS (для запобігання "стрибкам")
TRIP_FUEL_DISPLAY_WIDTH = const(4) # Ширина поля для TRIP Liters (XX.X)
TRIP_DISTANCE_DISPLAY_WIDTH = const(3) # Ширина поля для TRIP KM (XXX)
PERS_L100KM_DISPLAY_WIDTH = const(4) # Ширина поля для PERS L/100KM (XX.X)

# Екран аварійної помилки (відображається при критичних збоях програми)
LOOP_ERROR_TEXT_SIZE = const(1) # Розмір шрифту для тексту "LOOP ERR"
LOOP_ERROR_X_POS = const(25) # Позиція X тексту "LOOP ERR"
LOOP_ERROR_Y_POS = const(50) # Позиція Y тексту "LOOP ERR"

# Інтервал блимання для попереджень (мс)
BLINK_INTERVAL_MS = const(500)

# Максимальне значення L/100KM, яке відображається (для PERS та MAIN L/100KM).
# Якщо розраховане значення перевищує це, буде показано "----" або "-.--"
MAX_DISPLAY_L100KM_VALUE = const(99.9)


# ------------------------------------------------------------------------------
# 6. НАЛАШТУВАННЯ ПЕРЕВІРКИ ПОМИЛОК ТА ЗВУКУ
# ------------------------------------------------------------------------------
OIL_CHECK_DELAY_MS = const(5000) # Затримка перед активацією помилки "Низький тиск масла" після запуску двигуна (мс)
MIN_RPM_FOR_STABLE_RUNNING = const(550) # Мінімальні оберти для визначення "працюючого двигуна"
MIN_RPM_FOR_HIGH_PRESSURE_CHECK = const(2000) # Мінімальні оберти для перевірки датчика високого тиску мастила

# Послідовність звукових сигналів тривоги: (тривалість_мс, частота_Гц)
ALARM_SEQUENCE = [
    (150, 1200), (150, 800),    # "Бі-Бу"
    (150, 1200), (150, 800),    # Повтор
    (150, 1200), (150, 800),    # Повтор
    (15000, 0)# Повтор, потім довга пауза
]
ERROR_DISPLAY_CYCLE_MS = const(1500) # Інтервал перемикання між різними іконками помилок на екрані (мс)
MIN_SPEED_FOR_L100KM_KMH = const(10.0) # Мінімальна швидкість (км/год) для відображення показника L/100KM на головному екрані
MIN_DISTANCE_FOR_L100KM_KM = const(0.1) # Мінімальна пройдена відстань (км) для відображення показника L/100KM на головному екрані
STATIONARY_THRESHOLD = const(0.1) # Поріг для визначення стаціонарного стану (L/H), коли показувати "-.--"

# Налаштування для PERS (персистентна середня витрата)
MIN_SPEED_FOR_PERS_COUNT_KMH = const(1.0) # Мінімальна швидкість (км/год), вище якої PERS накопичує паливо та відстань
MIN_PERS_DISPLAY_DISTANCE_KM = const(0.5) # Мінімальна пройдена відстань (км), після якої PERS почне відображати L/100KM

# ------------------------------------------------------------------------------
# 7. СИСТЕМНІ НАЛАШТУВАННЯ ТА КАЛІБРУВАННЯ RPM
# ------------------------------------------------------------------------------
UPDATE_INTERVAL_SEC = const(1) # Інтервал оновлення екрану та розрахунків (1 секунда)

RPM_PULSES_PER_ENGINE_REVOLUTION = const(2) # Кількість імпульсів форсунки на один оберт колінчастого валу
RPM_CALCULATION_FACTOR = const(60 * 1_000_000 // RPM_PULSES_PER_ENGINE_REVOLUTION) # Коефіцієнт для обчислення RPM (для перетворення періоду в оберти)
MIN_INJ_PERIOD_US = const(4000) # Мінімальний період імпульсу форсунки (мкс) для коректного розрахунку RPM
VSS_DEBOUNCE_US = const(100) # Дебаунс для VSS IRQ (мкс)
I2C_FREQ = const(400000) # Частота I2C шини для OLED дисплея (Гц)
OLED_ADDR_HEX = const(0x3C) # Адреса OLED дисплея по I2C (в шістнадцятковому форматі)
OLED_CONTRAST = const(0xFF) # Контраст OLED дисплея (0x00 - найменший, 0xFF - найбільший)
STARTUP_OK_SCREEN_DURATION_SEC = const(3) # Тривалість відображення екрану "ОК" при запуску (секунди)
STARTUP_ERROR_SCREEN_DURATION_SEC = const(1) # Тривалість відображення першої помилки при запуску (секунди)
TRIP_DATA_FILE = 'trip_data.txt' # Ім'я файлу для збереження даних TRIP
TRIP_DATA_BACKUP = 'trip_data.bak' # Ім'я резервного файлу TRIP
TRIP_DATA_TEMP = 'trip_data.tmp' # Ім'я тимчасового файлу для атомарного збереження TRIP
PERSISTENT_SAVE_INTERVAL_MS = const(10000) # Інтервал збереження персистентних даних на Flash (мс)
RESET_PERSISTENT_TRIP_DISTANCE_KM = const(9999.9) # Відстань (км) для автоматичного скидання PERS
