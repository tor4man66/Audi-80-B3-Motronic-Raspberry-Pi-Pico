# ==============================================================================
# Тестовий скрипт: Калібратор рівня палива для Raspberry Pi Pico
# Автор: tor4man
# Дата: 2025-10-27
# Опис: Зчитує та виводить сирі 16-бітні значення ADC з призначеного піна.
#       Використовується для визначення FUEL_ADC_MIN_RAW та FUEL_ADC_MAX_RAW.
# ==============================================================================

from machine import Pin, ADC
import time
from micropython import const

# ------------------------------------------------------------------------------
# 1. НАЛАШТУВАННЯ ПІНА ADC (ЗМІНИ ПРИ НЕОБХІДНОСТІ)
# ------------------------------------------------------------------------------
# Це пін GPIO 28, який є ADC2 на Raspberry Pi Pico (фізичний пін 34).
# Зміни це значення, якщо ти використовуєш інший ADC пін.
PIN_FUEL_LEVEL_ADC = const(28)

# ------------------------------------------------------------------------------
# 2. ІНІЦІАЛІЗАЦІЯ
# ------------------------------------------------------------------------------
try:
    fuel_level_adc = ADC(Pin(PIN_FUEL_LEVEL_ADC))
    print(f"✅ ADC на піні GPIO {PIN_FUEL_LEVEL_ADC} успішно ініціалізовано.")
    print("------------------------------------------------------------------")
    print("Калібратор рівня палива запущено.")
    print("Зчитуються сирі 16-бітні значення ADC (0-65535).")
    print("Використайте ці значення для налаштування FUEL_ADC_MIN_RAW та FUEL_ADC_MAX_RAW.")
    print("Натисніть Ctrl+C в Thonny для зупинки.")
    print("------------------------------------------------------------------")
    time.sleep(1) # Невелика затримка перед початком виводу
except ValueError:
    print(f"❌ Помилка: GPIO {PIN_FUEL_LEVEL_ADC} не є аналоговим входом або недоступний.")
    print("Перевірте номер піна.")
    exit() # Завершуємо роботу скрипта, якщо ADC не ініціалізовано
except Exception as e:
    print(f"❌ Невідома помилка ініціалізації ADC: {e}")
    exit()

# ------------------------------------------------------------------------------
# 3. ГОЛОВНИЙ ЦИКЛ ЗЧИТУВАННЯ
# ------------------------------------------------------------------------------
try:
    while True:
        raw_adc_value = fuel_level_adc.read_u16() # Зчитуємо 16-бітне значення (0-65535)
        print(f"Сире значення ADC: {raw_adc_value}")
        time.sleep(1) # Затримка в 1 секунду для зручності спостереження

except KeyboardInterrupt:
    print("\nКалібратор зупинено користувачем.")
except Exception as e:
    print(f"\n❌ Виникла помилка під час роботи: {e}")
finally:
    print("Завершення роботи калібратора.")
